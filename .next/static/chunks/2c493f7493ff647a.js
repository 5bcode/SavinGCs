(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,81726,(e,t,s)=>{},6813,(e,t,s)=>{var n=e.i(66456);e.r(81726);var a=e.r(85228),r=a&&"object"==typeof a&&"default"in a?a:{default:a},i=void 0!==n.default&&n.default.env&&!0,o=function(e){return"[object String]"===Object.prototype.toString.call(e)},l=function(){function e(e){var t=void 0===e?{}:e,s=t.name,n=void 0===s?"stylesheet":s,a=t.optimizeForSpeed,r=void 0===a?i:a;c(o(n),"`name` must be a string"),this._name=n,this._deletedRulePlaceholder="#"+n+"-deleted-rule____{}",c("boolean"==typeof r,"`optimizeForSpeed` must be a boolean"),this._optimizeForSpeed=r,this._serverSheet=void 0,this._tags=[],this._injected=!1,this._rulesCount=0;var l="u">typeof window&&document.querySelector('meta[property="csp-nonce"]');this._nonce=l?l.getAttribute("content"):null}var t,s=e.prototype;return s.setOptimizeForSpeed=function(e){c("boolean"==typeof e,"`setOptimizeForSpeed` accepts a boolean"),c(0===this._rulesCount,"optimizeForSpeed cannot be when rules have already been inserted"),this.flush(),this._optimizeForSpeed=e,this.inject()},s.isOptimizeForSpeed=function(){return this._optimizeForSpeed},s.inject=function(){var e=this;if(c(!this._injected,"sheet already injected"),this._injected=!0,"u">typeof window&&this._optimizeForSpeed){this._tags[0]=this.makeStyleTag(this._name),this._optimizeForSpeed="insertRule"in this.getSheet(),this._optimizeForSpeed||(i||console.warn("StyleSheet: optimizeForSpeed mode not supported falling back to standard mode."),this.flush(),this._injected=!0);return}this._serverSheet={cssRules:[],insertRule:function(t,s){return"number"==typeof s?e._serverSheet.cssRules[s]={cssText:t}:e._serverSheet.cssRules.push({cssText:t}),s},deleteRule:function(t){e._serverSheet.cssRules[t]=null}}},s.getSheetForTag=function(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]},s.getSheet=function(){return this.getSheetForTag(this._tags[this._tags.length-1])},s.insertRule=function(e,t){if(c(o(e),"`insertRule` accepts only strings"),"u"<typeof window)return"number"!=typeof t&&(t=this._serverSheet.cssRules.length),this._serverSheet.insertRule(e,t),this._rulesCount++;if(this._optimizeForSpeed){var s=this.getSheet();"number"!=typeof t&&(t=s.cssRules.length);try{s.insertRule(e,t)}catch(t){return i||console.warn("StyleSheet: illegal rule: \n\n"+e+"\n\nSee https://stackoverflow.com/q/20007992 for more info"),-1}}else{var n=this._tags[t];this._tags.push(this.makeStyleTag(this._name,e,n))}return this._rulesCount++},s.replaceRule=function(e,t){if(this._optimizeForSpeed||"u"<typeof window){var s="u">typeof window?this.getSheet():this._serverSheet;if(t.trim()||(t=this._deletedRulePlaceholder),!s.cssRules[e])return e;s.deleteRule(e);try{s.insertRule(t,e)}catch(n){i||console.warn("StyleSheet: illegal rule: \n\n"+t+"\n\nSee https://stackoverflow.com/q/20007992 for more info"),s.insertRule(this._deletedRulePlaceholder,e)}}else{var n=this._tags[e];c(n,"old rule at index `"+e+"` not found"),n.textContent=t}return e},s.deleteRule=function(e){if("u"<typeof window)return void this._serverSheet.deleteRule(e);if(this._optimizeForSpeed)this.replaceRule(e,"");else{var t=this._tags[e];c(t,"rule at index `"+e+"` not found"),t.parentNode.removeChild(t),this._tags[e]=null}},s.flush=function(){this._injected=!1,this._rulesCount=0,"u">typeof window?(this._tags.forEach(function(e){return e&&e.parentNode.removeChild(e)}),this._tags=[]):this._serverSheet.cssRules=[]},s.cssRules=function(){var e=this;return"u"<typeof window?this._serverSheet.cssRules:this._tags.reduce(function(t,s){return s?t=t.concat(Array.prototype.map.call(e.getSheetForTag(s).cssRules,function(t){return t.cssText===e._deletedRulePlaceholder?null:t})):t.push(null),t},[])},s.makeStyleTag=function(e,t,s){t&&c(o(t),"makeStyleTag accepts only strings as second parameter");var n=document.createElement("style");this._nonce&&n.setAttribute("nonce",this._nonce),n.type="text/css",n.setAttribute("data-"+e,""),t&&n.appendChild(document.createTextNode(t));var a=document.head||document.getElementsByTagName("head")[0];return s?a.insertBefore(n,s):a.appendChild(n),n},t=[{key:"length",get:function(){return this._rulesCount}}],function(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(e.prototype,t),e}();function c(e,t){if(!e)throw Error("StyleSheet: "+t+".")}var d=function(e){for(var t=5381,s=e.length;s;)t=33*t^e.charCodeAt(--s);return t>>>0},h={};function m(e,t){if(!t)return"jsx-"+e;var s=String(t),n=e+s;return h[n]||(h[n]="jsx-"+d(e+"-"+s)),h[n]}function u(e,t){"u"<typeof window&&(t=t.replace(/\/style/gi,"\\/style"));var s=e+t;return h[s]||(h[s]=t.replace(/__jsx-style-dynamic-selector/g,e)),h[s]}var p=function(){function e(e){var t=void 0===e?{}:e,s=t.styleSheet,n=void 0===s?null:s,a=t.optimizeForSpeed,r=void 0!==a&&a;this._sheet=n||new l({name:"styled-jsx",optimizeForSpeed:r}),this._sheet.inject(),n&&"boolean"==typeof r&&(this._sheet.setOptimizeForSpeed(r),this._optimizeForSpeed=this._sheet.isOptimizeForSpeed()),this._fromServer=void 0,this._indices={},this._instancesCounts={}}var t=e.prototype;return t.add=function(e){var t=this;void 0===this._optimizeForSpeed&&(this._optimizeForSpeed=Array.isArray(e.children),this._sheet.setOptimizeForSpeed(this._optimizeForSpeed),this._optimizeForSpeed=this._sheet.isOptimizeForSpeed()),"u">typeof window&&!this._fromServer&&(this._fromServer=this.selectFromServer(),this._instancesCounts=Object.keys(this._fromServer).reduce(function(e,t){return e[t]=0,e},{}));var s=this.getIdAndRules(e),n=s.styleId,a=s.rules;if(n in this._instancesCounts){this._instancesCounts[n]+=1;return}var r=a.map(function(e){return t._sheet.insertRule(e)}).filter(function(e){return -1!==e});this._indices[n]=r,this._instancesCounts[n]=1},t.remove=function(e){var t=this,s=this.getIdAndRules(e).styleId;if(function(e,t){if(!e)throw Error("StyleSheetRegistry: "+t+".")}(s in this._instancesCounts,"styleId: `"+s+"` not found"),this._instancesCounts[s]-=1,this._instancesCounts[s]<1){var n=this._fromServer&&this._fromServer[s];n?(n.parentNode.removeChild(n),delete this._fromServer[s]):(this._indices[s].forEach(function(e){return t._sheet.deleteRule(e)}),delete this._indices[s]),delete this._instancesCounts[s]}},t.update=function(e,t){this.add(t),this.remove(e)},t.flush=function(){this._sheet.flush(),this._sheet.inject(),this._fromServer=void 0,this._indices={},this._instancesCounts={}},t.cssRules=function(){var e=this,t=this._fromServer?Object.keys(this._fromServer).map(function(t){return[t,e._fromServer[t]]}):[],s=this._sheet.cssRules();return t.concat(Object.keys(this._indices).map(function(t){return[t,e._indices[t].map(function(e){return s[e].cssText}).join(e._optimizeForSpeed?"":"\n")]}).filter(function(e){return!!e[1]}))},t.styles=function(e){var t,s;return t=this.cssRules(),void 0===(s=e)&&(s={}),t.map(function(e){var t=e[0],n=e[1];return r.default.createElement("style",{id:"__"+t,key:"__"+t,nonce:s.nonce?s.nonce:void 0,dangerouslySetInnerHTML:{__html:n}})})},t.getIdAndRules=function(e){var t=e.children,s=e.dynamic,n=e.id;if(s){var a=m(n,s);return{styleId:a,rules:Array.isArray(t)?t.map(function(e){return u(a,e)}):[u(a,t)]}}return{styleId:m(n),rules:Array.isArray(t)?t:[t]}},t.selectFromServer=function(){return Array.prototype.slice.call(document.querySelectorAll('[id^="__jsx-"]')).reduce(function(e,t){return e[t.id.slice(2)]=t,e},{})},e}(),x=a.createContext(null);function g(){return new p}function v(){return a.useContext(x)}x.displayName="StyleSheetContext";var f=r.default.useInsertionEffect||r.default.useLayoutEffect,y="u">typeof window?g():void 0;function j(e){var t=y||v();return t&&("u"<typeof window?t.add(e):f(function(){return t.add(e),function(){t.remove(e)}},[e.id,String(e.dynamic)])),null}j.dynamic=function(e){return e.map(function(e){return m(e[0],e[1])}).join(" ")},s.StyleRegistry=function(e){var t=e.registry,s=e.children,n=a.useContext(x),i=a.useState(function(){return n||t||g()})[0];return r.default.createElement(x.Provider,{value:i},s)},s.createStyleRegistry=g,s.style=j,s.useStyleRegistry=v},78190,(e,t,s)=>{t.exports=e.r(6813).style},68414,e=>{"use strict";var t=e.i(91823),s=e.i(85228);function n({onUpdateBalance:e,onAccountClick:n}){let[o,l]=(0,s.useState)([]),[c,d]=(0,s.useState)([]),[h,m]=(0,s.useState)(!0);(0,s.useEffect)(()=>{u()},[]);let u=async()=>{try{let[e,t]=await Promise.all([fetch("/api/pots"),fetch("/api/accounts")]),s=await e.json(),n=await t.json();l(s.pots||[]),d(n.accounts||[])}catch(e){console.error("Error fetching data:",e)}finally{m(!1)}},p=o.reduce((e,t)=>e+(t.total_balance||0),0),x=o.reduce((e,t)=>e+(t.goal_amount||0),0),g=x>0?p/x*100:0;return h?(0,t.jsxs)("div",{className:"stack",children:[(0,t.jsx)("div",{className:"skeleton",style:{height:"220px"}}),(0,t.jsx)("div",{className:"skeleton",style:{height:"100px"}}),(0,t.jsx)("div",{className:"skeleton",style:{height:"80px"}})]}):(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{style:{textAlign:"center",padding:"var(--sp-lg) 0 var(--sp-md)"},children:[(0,t.jsx)("div",{className:"balance-label",children:"Total Net Worth"}),(0,t.jsxs)("div",{className:"balance-amount",children:["Â£",p.toLocaleString("en-GB",{minimumFractionDigits:2,maximumFractionDigits:2})]}),x>0&&(0,t.jsxs)("div",{style:{fontSize:"0.8rem",color:"var(--text-tertiary)",marginTop:"6px"},children:[Math.min(g,100).toFixed(1),"% of Â£",x.toLocaleString("en-GB")," goal"]})]}),x>0&&(0,t.jsxs)("div",{className:"credit-card mb-lg",style:{position:"relative"},children:[(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"var(--sp-xl)",position:"relative",zIndex:1},children:[(0,t.jsx)(i,{percentage:Math.min(g,100),size:96,strokeWidth:7,children:(0,t.jsxs)("div",{style:{textAlign:"center"},children:[(0,t.jsxs)("div",{style:{fontFamily:"var(--font-mono)",fontSize:"1rem",fontWeight:700,color:"white",lineHeight:1},children:[Math.min(g,100).toFixed(0),"%"]}),(0,t.jsx)("div",{style:{fontSize:"0.55rem",color:"rgba(255,255,255,0.6)",marginTop:"2px"},children:"saved"})]})}),(0,t.jsxs)("div",{style:{flex:1},children:[(0,t.jsx)("div",{style:{fontSize:"0.7rem",fontWeight:600,opacity:.7,letterSpacing:"0.1em",textTransform:"uppercase",marginBottom:"4px"},children:"Savings Progress"}),(0,t.jsxs)("div",{style:{fontFamily:"var(--font-mono)",fontSize:"1.4rem",fontWeight:700,color:"white"},children:["Â£",p.toLocaleString("en-GB",{minimumFractionDigits:2})]}),(0,t.jsxs)("div",{style:{fontSize:"0.75rem",opacity:.6,marginTop:"4px"},children:["Â£",(x-p>0?x-p:0).toLocaleString("en-GB")," remaining"]})]})]}),(0,t.jsx)("div",{className:"wave-decoration",children:(0,t.jsxs)("svg",{viewBox:"0 0 400 80",fill:"none",preserveAspectRatio:"none",children:[(0,t.jsx)("path",{d:"M0 40 Q50 10 100 35 T200 30 T300 40 T400 25 L400 80 L0 80Z",fill:"rgba(13,148,136,0.3)"}),(0,t.jsx)("path",{d:"M0 50 Q60 25 120 45 T240 35 T360 50 T400 40 L400 80 L0 80Z",fill:"rgba(13,148,136,0.15)"})]})})]}),(0,t.jsxs)("button",{className:"btn btn-primary mb-lg",style:{width:"100%"},onClick:e,children:[(0,t.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,t.jsx)("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),(0,t.jsx)("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]}),"Update Balances"]}),(0,t.jsxs)("div",{className:"section-header",children:[(0,t.jsx)("div",{className:"section-title",children:"Savings Pots"}),(0,t.jsxs)("div",{className:"section-link",children:[o.length," pot",1!==o.length?"s":""]})]}),0===o.length?(0,t.jsxs)("div",{className:"empty-state",children:[(0,t.jsx)("div",{className:"empty-state-icon",children:"ðŸ¡"}),(0,t.jsxs)("div",{className:"empty-state-text",children:["No savings pots yet.",(0,t.jsx)("br",{}),"Go to Settings to create your first one!"]})]}):(0,t.jsx)("div",{className:"stack mb-xl",children:o.map(e=>{let s=c.filter(t=>t.pot_id===e.id);return(0,t.jsx)(a,{pot:e,accounts:s,onAccountClick:n},e.id)})}),c.length>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"section-header",children:[(0,t.jsx)("div",{className:"section-title",children:"All Accounts"}),(0,t.jsxs)("div",{className:"section-link",children:[c.length," account",1!==c.length?"s":""]})]}),(0,t.jsx)("div",{className:"stack",style:{gap:"var(--sp-sm)"},children:c.map(e=>(0,t.jsx)(r,{account:e,onClick:()=>n(e.id)},e.id))})]})]})}function a({pot:e,accounts:s,onAccountClick:n}){let a=Math.min(e.goal_amount?e.total_balance/e.goal_amount*100:0,100),r=e.goal_amount&&e.total_balance>=e.goal_amount;return(0,t.jsxs)("div",{className:"card",style:{padding:"var(--sp-lg)"},children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-md",children:[(0,t.jsxs)("div",{className:"flex items-center gap-md",children:[(0,t.jsx)("div",{className:"pot-icon",style:{background:`${e.color}25`},children:{"piggy-bank":"ðŸ·",house:"ðŸ¡",car:"ðŸš—",vacation:"ðŸ–ï¸",emergency:"ðŸš¨",wedding:"ðŸ’",education:"ðŸŽ“",savings:"ðŸ’°"}[e.icon]||"ðŸ’°"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{style:{fontWeight:700,fontSize:"1rem"},children:e.name}),e.goal_amount&&(0,t.jsxs)("div",{style:{fontSize:"0.75rem",color:"var(--text-tertiary)",marginTop:"2px"},children:["Goal: Â£",e.goal_amount.toLocaleString("en-GB")]})]})]}),(0,t.jsxs)("div",{style:{textAlign:"right"},children:[(0,t.jsxs)("div",{style:{fontFamily:"var(--font-mono)",fontWeight:700,fontSize:"1.1rem",color:"var(--text-primary)"},children:["Â£",e.total_balance.toLocaleString("en-GB",{minimumFractionDigits:2})]}),r&&(0,t.jsx)("div",{style:{fontSize:"0.7rem",color:"var(--success)",fontWeight:600,marginTop:"2px"},children:"âœ“ Goal reached"})]})]}),e.goal_amount&&(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"progress-track",style:{height:"8px",marginTop:0,marginBottom:"6px"},children:(0,t.jsx)("div",{className:`progress-fill${r?"":" purple"}`,style:{width:`${a}%`}})}),(0,t.jsxs)("div",{className:"flex justify-between",style:{fontSize:"0.7rem",color:"var(--text-tertiary)"},children:[(0,t.jsxs)("span",{children:[a.toFixed(1),"% complete"]}),(0,t.jsxs)("span",{children:["Â£",Math.max(0,(e.goal_amount||0)-e.total_balance).toLocaleString("en-GB")," to go"]})]})]}),s.length>0&&(0,t.jsx)("div",{style:{marginTop:"var(--sp-md)",paddingTop:"var(--sp-md)",borderTop:"1px solid var(--border)"},children:s.map(s=>(0,t.jsxs)("div",{className:"flex justify-between items-center",style:{padding:"6px 0",cursor:"pointer"},onClick:()=>n(s.id),children:[(0,t.jsxs)("div",{className:"flex items-center gap-sm",children:[(0,t.jsx)("div",{style:{width:"6px",height:"6px",borderRadius:"50%",background:e.color,flexShrink:0}}),(0,t.jsx)("span",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:s.account_name}),(0,t.jsxs)("span",{style:{fontSize:"0.65rem",color:"var(--text-tertiary)",padding:"1px 6px",background:"var(--bg-secondary)",borderRadius:"var(--r-sm)"},children:[s.account_type.toUpperCase()," Â· ",s.owner||"Joint"]})]}),(0,t.jsxs)("span",{style:{fontFamily:"var(--font-mono)",fontSize:"0.85rem",fontWeight:600,color:"var(--text-primary)"},children:["Â£",s.current_balance.toLocaleString("en-GB",{minimumFractionDigits:2})]})]},s.id))})]})}function r({account:e,onClick:s}){return(0,t.jsxs)("div",{className:"pot-item",onClick:s,children:[(0,t.jsx)("div",{className:"pot-icon",style:{background:`linear-gradient(135deg, ${e.pot_color||"var(--purple-start)"}30, ${e.pot_color||"var(--purple-start)"}10)`,fontSize:"1rem"},children:(0,t.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:e.pot_color||"var(--purple-mid)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,t.jsx)("rect",{x:"1",y:"4",width:"22",height:"16",rx:"2",ry:"2"}),(0,t.jsx)("line",{x1:"1",y1:"10",x2:"23",y2:"10"})]})}),(0,t.jsxs)("div",{className:"pot-info",children:[(0,t.jsx)("div",{className:"pot-name",children:e.account_name}),(0,t.jsxs)("div",{className:"pot-meta",children:[e.pot_name," Â· ",e.account_type," Â· ",e.owner||"Joint"]})]}),(0,t.jsxs)("div",{className:"pot-amount",children:["Â£",e.current_balance.toLocaleString("en-GB",{minimumFractionDigits:2})]})]})}function i({percentage:e,size:s=96,strokeWidth:n=7,children:a}){let r=(s-n)/2,i=2*r*Math.PI;return(0,t.jsxs)("div",{className:"ring-container",style:{width:s,height:s},children:[(0,t.jsxs)("svg",{width:s,height:s,viewBox:`0 0 ${s} ${s}`,children:[(0,t.jsx)("circle",{className:"ring-bg",cx:s/2,cy:s/2,r:r}),(0,t.jsx)("circle",{className:"ring-fill",cx:s/2,cy:s/2,r:r,stroke:"url(#ringGrad)",strokeDasharray:i,strokeDashoffset:i-e/100*i}),(0,t.jsx)("defs",{children:(0,t.jsxs)("linearGradient",{id:"ringGrad",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[(0,t.jsx)("stop",{offset:"0%",stopColor:"var(--purple-start)"}),(0,t.jsx)("stop",{offset:"100%",stopColor:"var(--teal-end)"})]})})]}),(0,t.jsx)("div",{className:"ring-text",children:a})]})}var o=e.i(78190);function l({onLogin:e}){let[n,a]=(0,s.useState)(""),[r,i]=(0,s.useState)(""),[l,c]=(0,s.useState)(!0),[d,h]=(0,s.useState)(""),[m,u]=(0,s.useState)(!1),p=async t=>{t.preventDefault(),h(""),u(!0);try{let t=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:n,password:r,rememberMe:l})}),s=await t.json();if(!t.ok)return void h(s.error||"Login failed");e(s.user)}catch(e){h("An error occurred. Please try again.")}finally{u(!1)}};return(0,t.jsxs)("div",{className:"jsx-37a81b79a982207d login-page",children:[(0,t.jsxs)("div",{className:"jsx-37a81b79a982207d login-card",children:[(0,t.jsxs)("div",{className:"jsx-37a81b79a982207d login-brand",children:[(0,t.jsx)("div",{className:"jsx-37a81b79a982207d login-logo",children:"ðŸ¡"}),(0,t.jsx)("h1",{className:"jsx-37a81b79a982207d login-title",children:"SavinGCs"}),(0,t.jsx)("p",{className:"jsx-37a81b79a982207d login-subtitle",children:"Track your savings together"})]}),(0,t.jsxs)("form",{onSubmit:p,className:"jsx-37a81b79a982207d card-glass",children:[(0,t.jsxs)("div",{className:"jsx-37a81b79a982207d form-group",children:[(0,t.jsx)("label",{htmlFor:"username",className:"jsx-37a81b79a982207d form-label",children:"Username"}),(0,t.jsx)("input",{id:"username",type:"text",value:n,onChange:e=>a(e.target.value),placeholder:"Enter username",required:!0,autoComplete:"username",className:"jsx-37a81b79a982207d form-input"})]}),(0,t.jsxs)("div",{className:"jsx-37a81b79a982207d form-group",children:[(0,t.jsx)("label",{htmlFor:"password",className:"jsx-37a81b79a982207d form-label",children:"Password"}),(0,t.jsx)("input",{id:"password",type:"password",value:r,onChange:e=>i(e.target.value),placeholder:"Enter password",required:!0,autoComplete:"current-password",className:"jsx-37a81b79a982207d form-input"})]}),(0,t.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"var(--sp-sm)",cursor:"pointer",marginBottom:"var(--sp-lg)",WebkitTapHighlightColor:"transparent"},className:"jsx-37a81b79a982207d",children:[(0,t.jsx)("input",{type:"checkbox",checked:l,onChange:e=>c(e.target.checked),style:{width:"18px",height:"18px",accentColor:"var(--purple-start)",cursor:"pointer"},className:"jsx-37a81b79a982207d"}),(0,t.jsx)("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},className:"jsx-37a81b79a982207d",children:"Remember me"})]}),d&&(0,t.jsx)("div",{className:"jsx-37a81b79a982207d error-badge",children:d}),(0,t.jsx)("button",{type:"submit",style:{width:"100%"},disabled:m,className:"jsx-37a81b79a982207d btn btn-primary",children:m?(0,t.jsxs)("span",{style:{display:"flex",alignItems:"center",gap:"8px"},className:"jsx-37a81b79a982207d",children:[(0,t.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",style:{animation:"spin 1s linear infinite"},className:"jsx-37a81b79a982207d",children:(0,t.jsx)("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"3",fill:"none",strokeDasharray:"60 30",className:"jsx-37a81b79a982207d"})}),"Signing in..."]}):"Sign In"})]})]}),(0,t.jsx)(o.default,{id:"37a81b79a982207d",children:"@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"})]})}function c(){let[e,n]=(0,s.useState)([]),[a,r]=(0,s.useState)(!0);(0,s.useEffect)(()=>{i()},[]);let i=async()=>{try{let e=await fetch("/api/transactions"),t=await e.json();n(t.transactions||[])}catch(e){console.error("Error fetching transactions:",e)}finally{r(!1)}},o=async()=>{try{let e=await fetch("/api/export/csv"),t=await e.blob(),s=window.URL.createObjectURL(t),n=document.createElement("a");n.href=s,n.download=`savings-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(s),document.body.removeChild(n)}catch(e){console.error("Export error:",e)}};if(a)return(0,t.jsx)("div",{className:"skeleton",style:{height:"300px"}});let l={};return e.forEach(e=>{let t=new Date(e.transaction_date).toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"});l[t]||(l[t]=[]),l[t].push(e)}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"section-header",children:[(0,t.jsx)("div",{className:"section-title",children:"Balance History"}),(0,t.jsxs)("button",{className:"btn btn-secondary",style:{padding:"8px 14px",minHeight:"auto",fontSize:"0.75rem"},onClick:o,children:[(0,t.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,t.jsx)("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),(0,t.jsx)("polyline",{points:"7 10 12 15 17 10"}),(0,t.jsx)("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),"Export"]})]}),(0,t.jsx)("p",{style:{fontSize:"0.8rem",color:"var(--text-tertiary)",marginBottom:"var(--sp-lg)"},children:"A log of all balance changes across your accounts."}),0===e.length?(0,t.jsxs)("div",{className:"empty-state",children:[(0,t.jsx)("div",{className:"empty-state-icon",children:"ðŸ“‹"}),(0,t.jsxs)("div",{className:"empty-state-text",children:["No history yet.",(0,t.jsx)("br",{}),"Balance changes will appear here."]})]}):Object.entries(l).map(([e,s])=>(0,t.jsxs)("div",{style:{marginBottom:"var(--sp-xl)"},children:[(0,t.jsx)("div",{style:{fontSize:"0.7rem",fontWeight:700,color:"var(--text-tertiary)",textTransform:"uppercase",letterSpacing:"0.08em",marginBottom:"var(--sp-sm)",padding:"0 2px"},children:e}),(0,t.jsx)("div",{className:"stack",style:{gap:"var(--sp-xs)"},children:s.map(e=>(0,t.jsxs)("div",{className:"pot-item",style:{cursor:"default",padding:"var(--sp-sm) var(--sp-md)"},children:[(0,t.jsx)("div",{style:{width:"36px",height:"36px",borderRadius:"var(--r-md)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,fontSize:"1rem",background:e.amount>=0?"linear-gradient(135deg, rgba(52, 211, 153, 0.15), rgba(52, 211, 153, 0.05))":"linear-gradient(135deg, rgba(248, 113, 113, 0.15), rgba(248, 113, 113, 0.05))"},children:e.amount>=0?"â†—":"â†™"}),(0,t.jsxs)("div",{className:"pot-info",children:[(0,t.jsx)("div",{style:{fontWeight:600,fontSize:"0.85rem"},children:e.account_name}),(0,t.jsxs)("div",{style:{fontSize:"0.7rem",color:"var(--text-tertiary)"},children:[e.description||e.pot_name," â€¢ ",e.user_name]})]}),(0,t.jsxs)("span",{style:{fontFamily:"var(--font-mono)",fontWeight:700,fontSize:"0.9rem",color:e.amount>=0?"var(--success)":"var(--error)"},children:[e.amount>=0?"+":"","Â£",Math.abs(e.amount).toLocaleString("en-GB",{minimumFractionDigits:2})]})]},e.id))})]},e))]})}function d({onUpdate:e}){let[n,a]=(0,s.useState)([]),[r,i]=(0,s.useState)(!1),[o,l]=(0,s.useState)({name:"",goalAmount:"",color:"#7B2FE0",icon:"piggy-bank"});(0,s.useEffect)(()=>{c()},[]);let c=async()=>{try{let e=await fetch("/api/pots"),t=await e.json();a(t.pots||[])}catch(e){console.error("Error fetching pots:",e)}},d=async t=>{t.preventDefault();try{if(!(await fetch("/api/pots",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:o.name,goalAmount:o.goalAmount?parseFloat(o.goalAmount):null,color:o.color,icon:o.icon,priority:0})})).ok)throw Error("Failed to create pot");l({name:"",goalAmount:"",color:"#7B2FE0",icon:"piggy-bank"}),i(!1),c(),e()}catch(e){console.error("Error creating pot:",e),alert("Failed to create savings pot")}},h=async t=>{if(confirm("Delete this pot and all its accounts/transactions?"))try{if(!(await fetch(`/api/pots/${t}`,{method:"DELETE"})).ok)throw Error("Failed to delete pot");c(),e()}catch(e){console.error("Error deleting pot:",e),alert("Failed to delete pot")}},m=[["house","ðŸ¡"],["piggy-bank","ðŸ·"],["car","ðŸš—"],["vacation","ðŸ–ï¸"],["emergency","ðŸš¨"],["wedding","ðŸ’"],["education","ðŸŽ“"],["savings","ðŸ’°"]];return(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"section-header",children:[(0,t.jsx)("div",{className:"section-title",children:"Savings Pots"}),(0,t.jsx)("button",{className:"btn btn-primary",style:{padding:"8px 16px",minHeight:"auto",fontSize:"0.8rem"},onClick:()=>i(!r),children:r?"Cancel":"+ New Pot"})]}),r&&(0,t.jsxs)("form",{onSubmit:d,className:"card mb-lg",children:[(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{className:"form-label",children:"Pot Name"}),(0,t.jsx)("input",{type:"text",className:"form-input",value:o.name,onChange:e=>l({...o,name:e.target.value}),placeholder:"e.g., House Deposit",required:!0})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{className:"form-label",children:"Goal Amount (Â£)"}),(0,t.jsx)("input",{type:"number",step:"0.01",className:"form-input",value:o.goalAmount,onChange:e=>l({...o,goalAmount:e.target.value}),placeholder:"Optional - e.g., 50000"})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{className:"form-label",children:"Icon"}),(0,t.jsx)("div",{className:"flex gap-sm",style:{flexWrap:"wrap"},children:m.map(([e,s])=>(0,t.jsx)("button",{type:"button",onClick:()=>l({...o,icon:e}),style:{width:"44px",height:"44px",borderRadius:"var(--r-md)",background:o.icon===e?"var(--purple-start)":"var(--bg-secondary)",border:o.icon===e?"2px solid var(--purple-mid)":"1px solid var(--border)",fontSize:"1.2rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all var(--t-fast)"},children:s},e))})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{className:"form-label",children:"Color"}),(0,t.jsx)("div",{className:"flex gap-sm",children:["#7B2FE0","#059669","#f59e0b","#ef4444","#3b82f6","#ec4899","#8b5cf6"].map(e=>(0,t.jsx)("button",{type:"button",onClick:()=>l({...o,color:e}),style:{width:"36px",height:"36px",borderRadius:"var(--r-full)",background:e,border:o.color===e?"3px solid white":"2px solid transparent",cursor:"pointer",transition:"all var(--t-fast)"}},e))})]}),(0,t.jsx)("button",{type:"submit",className:"btn btn-teal",style:{width:"100%"},children:"Create Pot"})]}),(0,t.jsx)("div",{className:"stack",style:{gap:"var(--sp-sm)"},children:n.map(e=>{let s="Unallocated"===e.name;return(0,t.jsxs)("div",{className:"pot-item",children:[(0,t.jsx)("div",{className:"pot-icon",style:{background:`${e.color}30`,fontSize:"1.3rem"},children:m.find(([t])=>t===e.icon)?.[1]||"ðŸ’°"}),(0,t.jsxs)("div",{className:"pot-info",children:[(0,t.jsx)("div",{className:"pot-name",children:e.name}),s?(0,t.jsx)("div",{className:"pot-meta",children:"Default Â· Cannot be deleted"}):e.goal_amount?(0,t.jsxs)("div",{className:"pot-meta",children:["Goal: Â£",e.goal_amount.toLocaleString("en-GB")]}):null]}),!s&&(0,t.jsx)("button",{onClick:()=>h(e.id),className:"icon-btn",style:{color:"var(--error)"},children:(0,t.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,t.jsx)("polyline",{points:"3 6 5 6 21 6"}),(0,t.jsx)("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})})]},e.id)})})]})}function h({onUpdate:e,onAccountClick:n}){let[a,r]=(0,s.useState)([]),[i,o]=(0,s.useState)([]),[l,c]=(0,s.useState)(!1),[d,h]=(0,s.useState)({potId:"",accountName:"",accountType:"savings",owner:"Joint",currentBalance:""});(0,s.useEffect)(()=>{m()},[]);let m=async()=>{try{let[e,t]=await Promise.all([fetch("/api/accounts"),fetch("/api/pots")]),s=await e.json(),n=(await t.json()).pots||[];if(r(s.accounts||[]),o(n),!d.potId){let e=n.find(e=>"Unallocated"===e.name);e&&h(t=>({...t,potId:String(e.id)}))}}catch(e){console.error("Error fetching data:",e)}},u=async t=>{t.preventDefault();try{if(!(await fetch("/api/accounts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({potId:parseInt(d.potId),accountName:d.accountName,accountType:d.accountType,owner:d.owner,currentBalance:parseFloat(d.currentBalance)||0})})).ok)throw Error("Failed to create account");h({potId:"",accountName:"",accountType:"savings",owner:"Joint",currentBalance:""}),c(!1),m(),e()}catch(e){console.error("Error creating account:",e),alert("Failed to create account")}},p=async t=>{if(confirm("Delete this account and all its transactions?"))try{if(!(await fetch(`/api/accounts/${t}`,{method:"DELETE"})).ok)throw Error("Failed to delete account");m(),e()}catch(e){console.error("Error deleting account:",e),alert("Failed to delete account")}},x={savings:"Savings",isa:"ISA",current:"Current",investment:"Investment",other:"Other"},g={};return a.forEach(e=>{g[e.pot_name]||(g[e.pot_name]={color:e.pot_color,accounts:[]}),g[e.pot_name].accounts.push(e)}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"section-header",children:[(0,t.jsx)("div",{className:"section-title",children:"Your Accounts"}),(0,t.jsx)("button",{className:"btn btn-primary",style:{padding:"8px 16px",minHeight:"auto",fontSize:"0.8rem"},onClick:()=>c(!l),children:l?"Cancel":"+ Add Account"})]}),(0,t.jsx)("p",{style:{fontSize:"0.8rem",color:"var(--text-tertiary)",marginBottom:"var(--sp-lg)"},children:"All your savings accounts, grouped by pot."}),l&&(0,t.jsxs)("form",{onSubmit:u,className:"card mb-lg",children:[(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{className:"form-label",children:"Savings Pot"}),(0,t.jsx)("select",{className:"form-select",value:d.potId,onChange:e=>h({...d,potId:e.target.value}),required:!0,children:i.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{className:"form-label",children:"Account Name"}),(0,t.jsx)("input",{type:"text",className:"form-input",value:d.accountName,onChange:e=>h({...d,accountName:e.target.value}),placeholder:"e.g., HSBC Lifetime ISA",required:!0})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{className:"form-label",children:"Account Type"}),(0,t.jsxs)("select",{className:"form-select",value:d.accountType,onChange:e=>h({...d,accountType:e.target.value}),children:[(0,t.jsx)("option",{value:"savings",children:"Savings Account"}),(0,t.jsx)("option",{value:"isa",children:"ISA"}),(0,t.jsx)("option",{value:"current",children:"Current Account"}),(0,t.jsx)("option",{value:"investment",children:"Investment Account"}),(0,t.jsx)("option",{value:"other",children:"Other"})]})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{className:"form-label",children:"Owner"}),(0,t.jsxs)("select",{className:"form-select",value:d.owner,onChange:e=>h({...d,owner:e.target.value}),children:[(0,t.jsx)("option",{value:"Gary",children:"Gary"}),(0,t.jsx)("option",{value:"Catherine",children:"Catherine"}),(0,t.jsx)("option",{value:"Joint",children:"Joint"})]})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{className:"form-label",children:"Current Balance (Â£)"}),(0,t.jsx)("input",{type:"number",step:"0.01",className:"form-input",value:d.currentBalance,onChange:e=>h({...d,currentBalance:e.target.value}),placeholder:"0.00",style:{fontFamily:"var(--font-mono)"}})]}),(0,t.jsx)("button",{type:"submit",className:"btn btn-teal",style:{width:"100%"},children:"Add Account"})]}),0===Object.keys(g).length&&!l&&(0,t.jsxs)("div",{className:"empty-state",children:[(0,t.jsx)("div",{className:"empty-state-icon",children:"ðŸ¦"}),(0,t.jsxs)("div",{className:"empty-state-text",children:["No accounts yet.",(0,t.jsx)("br",{}),"Add your first bank account above!"]})]}),Object.entries(g).map(([e,s])=>{let a=s.accounts.reduce((e,t)=>e+t.current_balance,0);return(0,t.jsxs)("div",{style:{marginBottom:"var(--sp-xl)"},children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",style:{marginBottom:"var(--sp-sm)",padding:"0 2px"},children:[(0,t.jsxs)("div",{className:"flex items-center gap-sm",children:[(0,t.jsx)("div",{style:{width:"8px",height:"8px",borderRadius:"50%",background:s.color}}),(0,t.jsx)("span",{style:{fontSize:"0.75rem",fontWeight:700,color:"var(--text-tertiary)",textTransform:"uppercase",letterSpacing:"0.08em"},children:e})]}),(0,t.jsxs)("span",{style:{fontSize:"0.8rem",fontFamily:"var(--font-mono)",fontWeight:600,color:"var(--text-secondary)"},children:["Â£",a.toLocaleString("en-GB",{minimumFractionDigits:2})]})]}),(0,t.jsx)("div",{className:"stack",style:{gap:"var(--sp-xs)"},children:s.accounts.map(e=>(0,t.jsxs)("div",{className:"pot-item",onClick:()=>n(e.id),children:[(0,t.jsx)("div",{className:"pot-icon",style:{background:`linear-gradient(135deg, ${e.pot_color}30, ${e.pot_color}10)`,fontSize:"1rem"},children:(0,t.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:e.pot_color||"var(--purple-mid)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,t.jsx)("rect",{x:"1",y:"4",width:"22",height:"16",rx:"2",ry:"2"}),(0,t.jsx)("line",{x1:"1",y1:"10",x2:"23",y2:"10"})]})}),(0,t.jsxs)("div",{className:"pot-info",children:[(0,t.jsx)("div",{className:"pot-name",children:e.account_name}),(0,t.jsxs)("div",{className:"pot-meta",children:[x[e.account_type]||e.account_type," Â· ",e.owner||"Joint"]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-sm",children:[(0,t.jsxs)("div",{className:"pot-amount",children:["Â£",e.current_balance.toLocaleString("en-GB",{minimumFractionDigits:2})]}),(0,t.jsx)("button",{onClick:t=>{t.stopPropagation(),p(e.id)},className:"icon-btn",style:{color:"var(--error)",width:"32px",height:"32px"},children:(0,t.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,t.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,t.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]})]},e.id))})]},e)})]})}function m({onSuccess:e,currentUser:n}){let[a,r]=(0,s.useState)([]),[i,o]=(0,s.useState)({}),[l,c]=(0,s.useState)(!0),[d,h]=(0,s.useState)(!1),[m,u]=(0,s.useState)(new Set);(0,s.useEffect)(()=>{p()},[]);let p=async()=>{try{let e=await fetch("/api/accounts"),t=(await e.json()).accounts||[];r(t);let s={};t.forEach(e=>{s[e.id]=e.current_balance.toFixed(2)}),o(s)}catch(e){console.error("Error fetching accounts:",e)}finally{c(!1)}},x=async e=>{let t=parseFloat(i[e.id]||"0");if(!isNaN(t)){h(!0);try{if(!(await fetch(`/api/accounts/${e.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({accountName:e.account_name,accountType:e.account_type,currentBalance:t})})).ok)throw Error("Failed to update");let s=t-e.current_balance;0!==s&&await fetch("/api/transactions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accountId:e.id,userId:n.id,amount:s,description:`Balance update: \xa3${e.current_balance.toFixed(2)} â†’ \xa3${t.toFixed(2)}`,transactionDate:new Date().toISOString().split("T")[0]})}),u(t=>new Set(t).add(e.id)),setTimeout(()=>u(t=>{let s=new Set(t);return s.delete(e.id),s}),2e3)}catch(e){console.error("Error updating balance:",e),alert("Failed to update balance")}finally{h(!1)}}},g=async()=>{for(let e of(h(!0),a)){let t=parseFloat(i[e.id]||"0");isNaN(t)||t===e.current_balance||await x(e)}h(!1),e()};if(l)return(0,t.jsx)("div",{className:"skeleton",style:{height:"200px"}});let v={};return a.forEach(e=>{v[e.pot_name]||(v[e.pot_name]=[]),v[e.pot_name].push(e)}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{style:{marginBottom:"var(--sp-xs)"},children:"Update Balances"}),(0,t.jsx)("p",{style:{fontSize:"0.8rem",color:"var(--text-tertiary)",marginBottom:"var(--sp-lg)"},children:"Enter the current balance for each account. Changes are logged automatically."}),0===a.length?(0,t.jsxs)("div",{className:"empty-state",children:[(0,t.jsx)("div",{className:"empty-state-icon",children:"ðŸ¦"}),(0,t.jsx)("div",{className:"empty-state-text",children:"No accounts yet. Add some in Settings first!"})]}):(0,t.jsxs)(t.Fragment,{children:[Object.entries(v).map(([e,s])=>(0,t.jsxs)("div",{style:{marginBottom:"var(--sp-lg)"},children:[(0,t.jsx)("div",{style:{fontSize:"0.7rem",fontWeight:700,color:"var(--text-tertiary)",textTransform:"uppercase",letterSpacing:"0.08em",marginBottom:"var(--sp-sm)",padding:"0 2px"},children:e}),(0,t.jsx)("div",{className:"stack",style:{gap:"var(--sp-sm)"},children:s.map(e=>(0,t.jsxs)("div",{className:"card",style:{padding:"var(--sp-md)"},children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{style:{fontWeight:600,fontSize:"0.9rem"},children:e.account_name}),(0,t.jsxs)("div",{style:{fontSize:"0.7rem",color:"var(--text-tertiary)"},children:["Current: Â£",e.current_balance.toLocaleString("en-GB",{minimumFractionDigits:2})," Â· ",e.account_type," Â· ",e.owner||"Joint"]})]}),m.has(e.id)&&(0,t.jsxs)("div",{style:{fontSize:"0.75rem",color:"var(--success)",fontWeight:600,display:"flex",alignItems:"center",gap:"4px"},children:[(0,t.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:(0,t.jsx)("polyline",{points:"20 6 9 17 4 12"})}),"Saved"]})]}),(0,t.jsxs)("div",{className:"flex gap-sm items-center",children:[(0,t.jsxs)("div",{style:{position:"relative",flex:1},children:[(0,t.jsx)("span",{style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"var(--text-tertiary)",fontWeight:600,fontSize:"1rem"},children:"Â£"}),(0,t.jsx)("input",{type:"number",step:"0.01",className:"form-input",value:i[e.id]||"",onChange:t=>o({...i,[e.id]:t.target.value}),style:{paddingLeft:"28px",fontFamily:"var(--font-mono)",fontWeight:700,fontSize:"1.05rem"}})]}),(0,t.jsx)("button",{type:"button",className:"btn btn-teal",style:{padding:"12px 16px",minHeight:"auto",fontSize:"0.8rem"},onClick:()=>x(e),disabled:d||parseFloat(i[e.id]||"0")===e.current_balance,children:"Save"})]}),parseFloat(i[e.id]||"0")!==e.current_balance&&(0,t.jsxs)("div",{style:{fontSize:"0.75rem",marginTop:"6px",fontWeight:600,fontFamily:"var(--font-mono)",color:parseFloat(i[e.id]||"0")>e.current_balance?"var(--success)":"var(--error)"},children:[parseFloat(i[e.id]||"0")>e.current_balance?"+":"","Â£",(parseFloat(i[e.id]||"0")-e.current_balance).toLocaleString("en-GB",{minimumFractionDigits:2})," change"]})]},e.id))})]},e)),(0,t.jsx)("button",{className:"btn btn-primary",style:{width:"100%",marginTop:"var(--sp-md)"},onClick:g,disabled:d,children:d?"Saving...":"Save All Changes"})]})]})}function u({accountId:e,currentUser:n,onClose:a,onUpdate:r}){let[i,o]=(0,s.useState)(null),[l,c]=(0,s.useState)([]),[d,h]=(0,s.useState)(0),[m,u]=(0,s.useState)(!0),[p,x]=(0,s.useState)(!1),[g,v]=(0,s.useState)(!1),[f,y]=(0,s.useState)(!1),[j,b]=(0,s.useState)(null),[S,N]=(0,s.useState)(""),[_,w]=(0,s.useState)(""),[k,C]=(0,s.useState)("");(0,s.useEffect)(()=>{F()},[e]);let F=async()=>{try{let t=await fetch(`/api/accounts/${e}`),s=await t.json();if(!t.ok)throw Error(s.error);o(s.account),c(s.history||[]),h(s.transactionCount||0),N(s.account.current_balance.toFixed(2)),w(s.account.account_type),C(s.account.owner||"Joint")}catch(e){console.error("Error fetching account:",e)}finally{u(!1)}},z=()=>!!i&&(_!==i.account_type||k!==(i.owner||"Joint")),B=async()=>{if(i){if(z()&&d>0&&!f){b({accountName:i.account_name,accountType:_,owner:k,currentBalance:parseFloat(S)}),y(!0);return}await T()}},T=async()=>{x(!0),y(!1);try{let t=parseFloat(S);if(!(await fetch(`/api/accounts/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({accountName:i.account_name,accountType:_,owner:k,currentBalance:t})})).ok)throw Error("Failed to update");let s=t-i.current_balance;0!==s&&await fetch("/api/transactions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accountId:i.id,userId:n.id,amount:s,description:`Balance update: \xa3${i.current_balance.toFixed(2)} â†’ \xa3${t.toFixed(2)}`,transactionDate:new Date().toISOString().split("T")[0]})}),v(!0),setTimeout(()=>{v(!1),r(),a()},1200)}catch(e){console.error("Error saving:",e),alert("Failed to save changes")}finally{x(!1)}},A=i?parseFloat(S)-i.current_balance:0,L=new Date().toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"});return m?(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"skeleton",style:{height:"40px",marginBottom:"16px"}}),(0,t.jsx)("div",{className:"skeleton",style:{height:"200px"}})]}):i?(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{style:{marginBottom:"var(--sp-lg)"},children:[(0,t.jsx)("h2",{style:{marginBottom:"4px"},children:i.account_name}),(0,t.jsxs)("div",{style:{fontSize:"0.8rem",color:"var(--text-tertiary)"},children:[i.pot_name," Â· ",{savings:"Savings",isa:"ISA",current:"Current",investment:"Investment",other:"Other"}[i.account_type]||i.account_type," Â· ",i.owner||"Joint"]}),(0,t.jsxs)("div",{style:{fontSize:"0.7rem",color:"var(--text-tertiary)",marginTop:"4px"},children:["Recording as at ",L]})]}),(0,t.jsxs)("div",{className:"card",style:{padding:"var(--sp-lg)",marginBottom:"var(--sp-lg)",textAlign:"center"},children:[(0,t.jsx)("div",{style:{fontSize:"0.7rem",fontWeight:600,color:"var(--text-tertiary)",textTransform:"uppercase",letterSpacing:"0.08em",marginBottom:"6px"},children:"Current Balance"}),(0,t.jsxs)("div",{style:{fontFamily:"var(--font-mono)",fontSize:"2rem",fontWeight:700,color:"var(--text-primary)"},children:["Â£",i.current_balance.toLocaleString("en-GB",{minimumFractionDigits:2})]})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{className:"form-label",children:"New Balance (Â£)"}),(0,t.jsxs)("div",{style:{position:"relative"},children:[(0,t.jsx)("span",{style:{position:"absolute",left:"14px",top:"50%",transform:"translateY(-50%)",color:"var(--text-tertiary)",fontWeight:700,fontSize:"1.1rem"},children:"Â£"}),(0,t.jsx)("input",{type:"number",step:"0.01",className:"form-input",value:S,onChange:e=>N(e.target.value),style:{paddingLeft:"30px",fontFamily:"var(--font-mono)",fontWeight:700,fontSize:"1.2rem"}})]}),0!==A&&!isNaN(A)&&(0,t.jsxs)("div",{style:{fontSize:"0.8rem",marginTop:"6px",fontWeight:700,fontFamily:"var(--font-mono)",color:A>0?"var(--success)":"var(--error)",display:"flex",alignItems:"center",gap:"4px"},children:[A>0?"â†‘":"â†“"," ",A>0?"+":"","Â£",A.toLocaleString("en-GB",{minimumFractionDigits:2})]})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{className:"form-label",children:"Account Type"}),(0,t.jsxs)("select",{className:"form-select",value:_,onChange:e=>w(e.target.value),children:[(0,t.jsx)("option",{value:"savings",children:"Savings Account"}),(0,t.jsx)("option",{value:"isa",children:"ISA"}),(0,t.jsx)("option",{value:"current",children:"Current Account"}),(0,t.jsx)("option",{value:"investment",children:"Investment Account"}),(0,t.jsx)("option",{value:"other",children:"Other"})]})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{className:"form-label",children:"Owner"}),(0,t.jsxs)("select",{className:"form-select",value:k,onChange:e=>C(e.target.value),children:[(0,t.jsx)("option",{value:"Gary",children:"Gary"}),(0,t.jsx)("option",{value:"Catherine",children:"Catherine"}),(0,t.jsx)("option",{value:"Joint",children:"Joint"})]})]}),f&&(0,t.jsx)("div",{style:{background:"rgba(251, 191, 36, 0.1)",border:"1px solid rgba(251, 191, 36, 0.3)",borderRadius:"var(--r-lg)",padding:"var(--sp-md)",marginBottom:"var(--sp-md)"},children:(0,t.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",gap:"var(--sp-sm)"},children:[(0,t.jsx)("span",{style:{fontSize:"1.2rem",lineHeight:1},children:"âš ï¸"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{style:{fontWeight:700,fontSize:"0.85rem",color:"var(--warning)",marginBottom:"4px"},children:"Changing account details"}),(0,t.jsxs)("div",{style:{fontSize:"0.78rem",color:"var(--text-secondary)",lineHeight:1.5},children:["This account has ",(0,t.jsxs)("strong",{children:[d," balance change",1!==d?"s":""]})," in its history. Changing the type or owner won't affect historical records, but could make past entries misleading."]}),(0,t.jsxs)("div",{style:{fontSize:"0.75rem",color:"var(--text-tertiary)",marginTop:"6px",lineHeight:1.5},children:["ðŸ’¡ ",(0,t.jsx)("strong",{children:"Recommendation:"})," If this is a fundamentally different account, consider deleting this one and creating a new account instead to keep your history clean."]}),(0,t.jsxs)("div",{style:{display:"flex",gap:"var(--sp-sm)",marginTop:"var(--sp-md)"},children:[(0,t.jsx)("button",{className:"btn btn-secondary",style:{flex:1,padding:"10px",minHeight:"auto",fontSize:"0.8rem"},onClick:()=>y(!1),children:"Cancel"}),(0,t.jsx)("button",{className:"btn",style:{flex:1,padding:"10px",minHeight:"auto",fontSize:"0.8rem",background:"var(--warning)",color:"#000",fontWeight:700},onClick:T,children:"Save Anyway"})]})]})]})}),!f&&(0,t.jsx)("button",{className:"btn btn-primary",style:{width:"100%",marginBottom:"var(--sp-lg)"},onClick:B,disabled:p||g||!(i&&parseFloat(S)!==i.current_balance)&&!z(),children:g?(0,t.jsxs)("span",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:[(0,t.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:(0,t.jsx)("polyline",{points:"20 6 9 17 4 12"})}),"Saved"]}):p?"Saving...":"Save Changes"}),l.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"section-header",style:{marginTop:"var(--sp-md)"},children:[(0,t.jsx)("div",{className:"section-title",style:{fontSize:"0.95rem"},children:"Balance History"}),(0,t.jsxs)("div",{className:"section-link",children:[l.length," record",1!==l.length?"s":""]})]}),(0,t.jsx)("div",{className:"stack",style:{gap:"var(--sp-xs)"},children:l.map((e,s)=>{let n=s<l.length-1?l[s+1].balance:null,a=null!==n?e.balance-n:null;return(0,t.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"var(--sp-sm) var(--sp-md)",background:"var(--bg-card)",borderRadius:"var(--r-md)",border:"1px solid var(--border)"},children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",fontWeight:600},children:new Date(e.recorded_date).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})}),null!==a&&(0,t.jsxs)("div",{style:{fontSize:"0.7rem",fontFamily:"var(--font-mono)",fontWeight:600,marginTop:"2px",color:a>=0?"var(--success)":"var(--error)"},children:[a>=0?"+":"","Â£",a.toLocaleString("en-GB",{minimumFractionDigits:2})]})]}),(0,t.jsxs)("div",{style:{fontFamily:"var(--font-mono)",fontWeight:700,fontSize:"0.9rem",color:"var(--text-primary)"},children:["Â£",e.balance.toLocaleString("en-GB",{minimumFractionDigits:2})]})]},s)})})]})]}):(0,t.jsx)("div",{className:"empty-state",children:(0,t.jsx)("div",{className:"empty-state-text",children:"Account not found"})})}function p(){let[e,a]=(0,s.useState)(null),[r,i]=(0,s.useState)("home"),[o,p]=(0,s.useState)(!0),[x,g]=(0,s.useState)(!1),[v,f]=(0,s.useState)(null),[y,j]=(0,s.useState)(0);(0,s.useEffect)(()=>{b()},[]);let b=async()=>{try{let e=await fetch("/api/auth/session");if(e.ok){let t=await e.json();t.authenticated&&a(t.user)}}catch(e){console.error("Session check error:",e)}finally{p(!1)}},S=async()=>{await fetch("/api/auth/session",{method:"POST"}),a(null)},N=e=>{f(e)},_=()=>{f(null)};return o?(0,t.jsx)("div",{className:"app-shell",style:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"100dvh"},children:(0,t.jsx)("div",{className:"skeleton",style:{width:"280px",height:"380px"}})}):e?(0,t.jsxs)("div",{className:"app-shell",children:[(0,t.jsxs)("div",{className:"app-header",children:[(0,t.jsxs)("div",{className:"header-user",children:[(0,t.jsx)("div",{className:"avatar",children:e.displayName?.charAt(0)||"U"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"header-greeting",children:"Welcome back"}),(0,t.jsx)("div",{className:"header-name",children:e.displayName})]})]}),(0,t.jsx)("div",{className:"header-actions",children:(0,t.jsx)("button",{className:"icon-btn",onClick:S,title:"Logout",children:(0,t.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,t.jsx)("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),(0,t.jsx)("polyline",{points:"16 17 21 12 16 7"}),(0,t.jsx)("line",{x1:"21",y1:"12",x2:"9",y2:"12"})]})})})]}),(0,t.jsxs)("div",{className:"app-content",children:["home"===r&&(0,t.jsx)(n,{onUpdateBalance:()=>g(!0),onAccountClick:N},y),"accounts"===r&&(0,t.jsx)(h,{onUpdate:()=>j(e=>e+1),onAccountClick:N},y),"history"===r&&(0,t.jsx)(c,{},y),"manage"===r&&(0,t.jsx)(d,{onUpdate:()=>j(e=>e+1)},y)]}),(0,t.jsxs)("nav",{className:"tab-bar",children:[(0,t.jsxs)("button",{className:`tab-item${"home"===r?" active":""}`,onClick:()=>i("home"),children:[(0,t.jsx)("span",{className:"tab-icon",children:(0,t.jsxs)("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,t.jsx)("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),(0,t.jsx)("polyline",{points:"9 22 9 12 15 12 15 22"})]})}),"Home"]}),(0,t.jsxs)("button",{className:`tab-item${"accounts"===r?" active":""}`,onClick:()=>i("accounts"),children:[(0,t.jsx)("span",{className:"tab-icon",children:(0,t.jsxs)("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,t.jsx)("rect",{x:"1",y:"4",width:"22",height:"16",rx:"2",ry:"2"}),(0,t.jsx)("line",{x1:"1",y1:"10",x2:"23",y2:"10"})]})}),"Accounts"]}),(0,t.jsx)("button",{className:"tab-fab",onClick:()=>g(!0),title:"Update Balance",children:(0,t.jsxs)("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,t.jsx)("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),(0,t.jsx)("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]})}),(0,t.jsxs)("button",{className:`tab-item${"history"===r?" active":""}`,onClick:()=>i("history"),children:[(0,t.jsx)("span",{className:"tab-icon",children:(0,t.jsxs)("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,t.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,t.jsx)("polyline",{points:"12 6 12 12 16 14"})]})}),"History"]}),(0,t.jsxs)("button",{className:`tab-item${"manage"===r?" active":""}`,onClick:()=>i("manage"),children:[(0,t.jsx)("span",{className:"tab-icon",children:(0,t.jsxs)("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,t.jsx)("circle",{cx:"12",cy:"12",r:"3"}),(0,t.jsx)("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]})}),"Settings"]})]}),x&&(0,t.jsx)("div",{className:"modal-overlay",onClick:e=>{e.target===e.currentTarget&&g(!1)},children:(0,t.jsxs)("div",{className:"modal-sheet",children:[(0,t.jsx)("div",{className:"modal-handle"}),(0,t.jsx)(m,{onSuccess:()=>{g(!1),j(e=>e+1)},currentUser:e})]})}),null!==v&&(0,t.jsx)("div",{className:"modal-overlay",onClick:e=>{e.target===e.currentTarget&&_()},children:(0,t.jsxs)("div",{className:"modal-sheet",children:[(0,t.jsx)("div",{className:"modal-handle"}),(0,t.jsx)(u,{accountId:v,currentUser:e,onClose:_,onUpdate:()=>{j(e=>e+1)}})]})})]}):(0,t.jsx)(l,{onLogin:a})}e.s(["default",()=>p],68414)}]);