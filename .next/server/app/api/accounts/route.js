"use strict";(()=>{var e={};e.id=101,e.ids=[101],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},1017:e=>{e.exports=require("path")},6086:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>E,patchFetch:()=>R,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>x,staticGenerationAsyncStorage:()=>w});var a={};r.r(a),r.d(a,{GET:()=>i,POST:()=>p});var s=r(9303),n=r(8716),o=r(670),c=r(7070),u=r(4677);async function i(){try{let e=await u.wp.execute(`
            SELECT 
                a.*,
                sp.name as pot_name,
                sp.color as pot_color
            FROM accounts a
            JOIN savings_pots sp ON sp.id = a.pot_id
            ORDER BY sp.priority DESC, a.account_name ASC
        `);return c.NextResponse.json({accounts:e.rows})}catch(e){return console.error("Error fetching accounts:",e),c.NextResponse.json({error:"Failed to fetch accounts"},{status:500})}}async function p(e){try{let t=await e.json(),{pot_id:r,account_name:a,account_type:s,current_balance:n,owner:o,starting_balance_date:i}=t,p=r||t.potId,l=a||t.accountName,d=s||t.accountType,w=n||t.currentBalance||0,x=o||t.owner||"Joint",E=i||t.startingBalanceDate||new Date().toISOString().split("T")[0],R=parseFloat(w),g=1,T=await u.wp.execute({sql:"SELECT id FROM users WHERE display_name = ?",args:[x]});T.rows.length>0&&(g=Number(T.rows[0].id));let A=await u.wp.execute({sql:`INSERT INTO accounts (pot_id, account_name, account_type, owner, current_balance, last_updated)
                  VALUES (?, ?, ?, ?, ?, CURRENT_TIMESTAMP) RETURNING id`,args:[p,l,d,x,R]}),m=Number(A.lastInsertRowid);return!m&&A.rows.length>0&&(m=Number(A.rows[0].id)),(0!==R||t.startingBalanceDate)&&await u.wp.execute({sql:`INSERT INTO transactions (account_id, user_id, amount, description, transaction_date)
                      VALUES (?, ?, ?, 'Opening Balance', ?)`,args:[m,g,R,E]}),c.NextResponse.json({success:!0,id:m})}catch(e){return console.error("Error creating account:",e),c.NextResponse.json({error:"Failed to create account"},{status:500})}}let l=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/accounts/route",pathname:"/api/accounts",filename:"route",bundlePath:"app/api/accounts/route"},resolvedPagePath:"C:\\Users\\G\\Desktop\\SavinGCs\\app\\api\\accounts\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:d,staticGenerationAsyncStorage:w,serverHooks:x}=l,E="/api/accounts/route";function R(){return(0,o.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:w})}},4677:(e,t,r)=>{r.d(t,{wp:()=>s});let a=require("@libsql/client");require("fs"),r(1017),r(8691),process.env.DATABASE_URL?.includes("libsql")||process.env.DATABASE_URL?.includes("turso");let s=(0,a.createClient)({url:process.env.DATABASE_URL||"file:savings-tracker.db",authToken:process.env.DATABASE_AUTH_TOKEN});class n{prepare(e){return{get:async(...t)=>(await s.execute({sql:e,args:t})).rows[0],all:async(...t)=>(await s.execute({sql:e,args:t})).rows,run:async(...t)=>{let r=await s.execute({sql:e,args:t});return{lastInsertRowid:r.lastInsertRowid,changes:r.rowsAffected}}}}transaction(e){return async(...t)=>(console.warn("Transactions are not fully supported in async wrapper yet."),e(t))}pragma(e){}exec(e){return s.executeMultiple(e)}}new n}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[948,972,691],()=>r(6086));module.exports=a})();